var arwpTmpl='<li><a href="{{href}}">{{title}}</a></li>',ArcwPopover=function(){var a=this;this.links=jQuery(".has-posts a"),this.calendars=jQuery(".calendar-archives"),a._popover()};ArcwPopover.prototype._setContent=function(a){var b=jQuery(a.data("cal")),c=a.data("content"),d=b.data("popover").find("#arcwp-content"),e=jQuery("<ul></ul>");c.posts.forEach(function(a){e.append(arwpTmpl.replace("{{href}}",a.permalink).replace("{{title}}",a.title))}),c.more&&e.append(jQuery(arwpTmpl.replace("{{href}}",a.attr("href")).replace("{{title}}",c.more+" >")).addClass("arcwp-more")),d.html(e)},ArcwPopover.prototype._loading=function(a){var b=a.data("cal"),c=(b.data("popover"),b.data("popover").find("#arcwp-content"));c.html('<span class="loading"><span class="loader"></span></span>')},ArcwPopover.prototype._setError=function(a){var b=a.data("cal"),c=b.data("popover").find("#arcwp-content");c.html('<span class="arcwp-error">Error</span>')},ArcwPopover.prototype._popover=function(){var a=this;a.calendars.each(function(a,b){var c=jQuery('<div class="arcw-popover"><div id="arcwp-content"></div></div>'),d=jQuery(b);d.append(c),d.data("popover",c)})},ArcwPopover.prototype.hide=function(a){var b=a.data("cal");b.removeClass("hover")},ArcwPopover.prototype._show=function(a){var b=a.data("cal"),c=b.data("popover");b.addClass("hover");var d=b.offset(),e=a.offset();c.css({top:e.top-d.top+a.outerHeight(),left:e.left-d.left-75+a.width()/2})},ArcwPopover.prototype.popover=function(a){var b=this;if(a.data("cal")||a.data("cal",a.parents(".calendar-archives")),b._show(a),a.data("content"))return void b._setContent(a);var c=a.attr("href"),d=a.attr("data-date");b._loading(a),b._getPosts(c,d).done(function(c){var d=JSON.parse(c);d.posts.length&&(a.data("content",d),b._setContent(a))}).fail(function(){b._setError(a)})},ArcwPopover.prototype._getPosts=function(a,b){var c={action:"get_archives_list",link:a,date:b};return jQuery.ajax({url:ajaxurl,method:"POST",data:c,async:!0})},jQuery(function(a){var b=new ArcwPopover;a(".calendar-archives .has-posts a").on("mouseenter",function(){var c=a(this);b.popover(c)}).on("mouseleave",function(){var c=a(this);b.hide(c)})});